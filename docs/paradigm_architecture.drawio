<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="Claude" version="21.0.0" etag="paradigm-architecture" type="device">
  <diagram id="paradigm-architecture" name="Paradigm Architecture">
    <mxGraphModel dx="1434" dy="844" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="Modular RL Paradigm Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="20" width="400" height="40" as="geometry" />
        </mxCell>

        <!-- Layer 1: Entry Point -->
        <mxCell id="layer1-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="1520" height="100" as="geometry" />
        </mxCell>
        <mxCell id="layer1-label" value="Entry Point &amp; Config Loading" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="85" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="train-script" value="scripts/train.py&#xa;- Parse args&#xa;- Load config&#xa;- Detect paradigm" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="80" y="115" width="180" height="55" as="geometry" />
        </mxCell>

        <mxCell id="config-loader" value="load_config()&#xa;- Parse YAML&#xa;- Validate&#xa;- Apply overrides" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="300" y="115" width="180" height="55" as="geometry" />
        </mxCell>

        <mxCell id="paradigm-router" value="get_trainer_for_paradigm()&#xa;- Dynamic import&#xa;- Returns trainer factory" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="520" y="115" width="200" height="55" as="geometry" />
        </mxCell>

        <mxCell id="config-yaml" value="ppo_cartpole.yaml&#xa;paradigm: model_free&#xa;algorithm: paradigm_ppo" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="760" y="105" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- Arrow from train-script to config-loader -->
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="train-script" target="config-loader">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrow from config-loader to paradigm-router -->
        <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="config-loader" target="paradigm-router">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Layer 2: Trainer Initialization -->
        <mxCell id="layer2-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="210" width="1520" height="120" as="geometry" />
        </mxCell>
        <mxCell id="layer2-label" value="Trainer Initialization" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="215" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="trainer-init" value="Trainer.__init__()&#xa;- Setup experiment dir&#xa;- Initialize logging&#xa;- auto_import_modules()&#xa;- _initialize_components()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="80" y="250" width="200" height="70" as="geometry" />
        </mxCell>

        <mxCell id="auto-import" value="auto_import_modules()&#xa;- Import all .py files&#xa;- Populate registries&#xa;- Register components" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="320" y="250" width="200" height="70" as="geometry" />
        </mxCell>

        <mxCell id="registries" value="Component Registries&#xa;ALGORITHM_REGISTRY&#xa;ENCODER_REGISTRY&#xa;POLICY_HEAD_REGISTRY&#xa;VALUE_FUNCTION_REGISTRY" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="560" y="235" width="200" height="90" as="geometry" />
        </mxCell>

        <!-- Arrow from paradigm-router to trainer-init -->
        <mxCell id="arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="paradigm-router" target="trainer-init">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="620" y="200" />
              <mxPoint x="180" y="200" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Arrow from trainer-init to auto-import -->
        <mxCell id="arrow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="trainer-init" target="auto-import">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrow from auto-import to registries -->
        <mxCell id="arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="auto-import" target="registries">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Layer 3: Component Creation -->
        <mxCell id="layer3-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="360" width="1520" height="180" as="geometry" />
        </mxCell>
        <mxCell id="layer3-label" value="Modular Component Creation" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="365" width="250" height="30" as="geometry" />
        </mxCell>

        <mxCell id="init-components" value="_initialize_components()&#xa;1. Create environments&#xa;2. Create modular components&#xa;3. Create algorithm&#xa;4. Inject components&#xa;5. Create buffer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="400" width="220" height="130" as="geometry" />
        </mxCell>

        <!-- Environment -->
        <mxCell id="environment" value="Environment&#xa;GymWrapper&#xa;CartPole-v1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="340" y="400" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Modular Components Box -->
        <mxCell id="components-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#d79b00;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="380" width="420" height="150" as="geometry" />
        </mxCell>
        <mxCell id="components-label" value="Modular Components" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="640" y="385" width="180" height="20" as="geometry" />
        </mxCell>

        <mxCell id="encoder" value="Encoder&#xa;MLPEncoder&#xa;Input: (4,)&#xa;Output: (64,)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="540" y="415" width="110" height="100" as="geometry" />
        </mxCell>

        <mxCell id="policy-head" value="Policy Head&#xa;CategoricalMLP&#xa;Input: (64,)&#xa;Output: (2,)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="670" y="415" width="120" height="100" as="geometry" />
        </mxCell>

        <mxCell id="value-fn" value="Value Function&#xa;CriticMLP&#xa;Input: (64,)&#xa;Output: (1,)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="810" y="415" width="110" height="100" as="geometry" />
        </mxCell>

        <!-- Buffer -->
        <mxCell id="buffer" value="Buffer&#xa;TrajectoryBuffer&#xa;GAE computation&#xa;capacity: 2048" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="340" y="475" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Layer 4: Algorithm -->
        <mxCell id="layer4-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="570" width="1520" height="200" as="geometry" />
        </mxCell>
        <mxCell id="layer4-label" value="Algorithm Layer" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="575" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="algorithm-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#b85450;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="610" width="860" height="145" as="geometry" />
        </mxCell>
        <mxCell id="algorithm-label" value="PPOAlgorithm (paradigm_ppo)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="615" width="200" height="20" as="geometry" />
        </mxCell>

        <mxCell id="algo-init" value="__init__()&#xa;- Store hyperparams&#xa;- clip_ratio: 0.2&#xa;- value_coef: 0.5&#xa;- entropy_coef: 0.01&#xa;- Set device" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;" vertex="1" parent="1">
          <mxGeometry x="100" y="645" width="180" height="100" as="geometry" />
        </mxCell>

        <mxCell id="set-components" value="set_components()&#xa;1. Store encoder&#xa;2. Store policy_head&#xa;3. Store value_function&#xa;4. Create CompositeActor&#xa;5. Create CompositeCritic&#xa;6. Create optimizers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;" vertex="1" parent="1">
          <mxGeometry x="300" y="645" width="200" height="100" as="geometry" />
        </mxCell>

        <mxCell id="composite-networks" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#b85450;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="645" width="400" height="100" as="geometry" />
        </mxCell>
        <mxCell id="composite-label" value="Composite Networks" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="620" y="650" width="200" height="20" as="geometry" />
        </mxCell>

        <mxCell id="composite-actor" value="CompositeActor&#xa;encoder → policy_head&#xa;Trainable params" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="540" y="680" width="160" height="55" as="geometry" />
        </mxCell>

        <mxCell id="composite-critic" value="CompositeCritic&#xa;encoder → value_fn&#xa;Trainable params" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="730" y="680" width="160" height="55" as="geometry" />
        </mxCell>

        <!-- Optimizers -->
        <mxCell id="optimizers-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#b85450;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="960" y="610" width="260" height="145" as="geometry" />
        </mxCell>
        <mxCell id="optimizers-label" value="Optimizers" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1020" y="615" width="140" height="20" as="geometry" />
        </mxCell>

        <mxCell id="actor-optimizer" value="Actor Optimizer&#xa;Adam(lr=3e-4)&#xa;Parameters:&#xa;- encoder&#xa;- policy_head" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;" vertex="1" parent="1">
          <mxGeometry x="980" y="645" width="110" height="90" as="geometry" />
        </mxCell>

        <mxCell id="critic-optimizer" value="Critic Optimizer&#xa;Adam(lr=3e-4)&#xa;Parameters:&#xa;- encoder&#xa;- value_fn" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;" vertex="1" parent="1">
          <mxGeometry x="1100" y="645" width="110" height="90" as="geometry" />
        </mxCell>

        <!-- Arrows from components to algorithm -->
        <mxCell id="arrow-enc-to-algo" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#d79b00;strokeWidth=2;" edge="1" parent="1" source="encoder" target="set-components">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="595" y="550" />
              <mxPoint x="400" y="550" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-enc-label" value="inject" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="arrow-enc-to-algo">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-policy-to-algo" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#d79b00;strokeWidth=2;" edge="1" parent="1" source="policy-head" target="set-components">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="730" y="550" />
              <mxPoint x="400" y="550" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-value-to-algo" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#d79b00;strokeWidth=2;" edge="1" parent="1" source="value-fn" target="set-components">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="865" y="550" />
              <mxPoint x="400" y="550" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Layer 5: Training Loop -->
        <mxCell id="layer5-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="800" width="1520" height="180" as="geometry" />
        </mxCell>
        <mxCell id="layer5-label" value="Training Loop" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="805" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="train-loop" value="train()&#xa;Main training loop&#xa;Until total_timesteps" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="840" width="160" height="60" as="geometry" />
        </mxCell>

        <mxCell id="training-step" value="_training_step()&#xa;1. Collect experience&#xa;2. Add to buffer&#xa;3. Update if ready" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;" vertex="1" parent="1">
          <mxGeometry x="280" y="840" width="180" height="60" as="geometry" />
        </mxCell>

        <mxCell id="collect-exp" value="get_action_and_value()&#xa;Forward pass:&#xa;- actor(obs) → action&#xa;- critic(obs) → value&#xa;- Sample action&#xa;- Compute log_prob" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;" vertex="1" parent="1">
          <mxGeometry x="500" y="840" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="env-step" value="environment.step()&#xa;Execute action&#xa;Get reward, done&#xa;Track episodes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;" vertex="1" parent="1">
          <mxGeometry x="740" y="840" width="160" height="80" as="geometry" />
        </mxCell>

        <!-- Arrows in training loop -->
        <mxCell id="arrow-train-to-step" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="train-loop" target="training-step">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-step-to-collect" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="training-step" target="collect-exp">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-collect-to-env" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="collect-exp" target="env-step">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Layer 6: Update Step -->
        <mxCell id="layer6-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="1010" width="1520" height="170" as="geometry" />
        </mxCell>
        <mxCell id="layer6-label" value="PPO Update Step (Backpropagation)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="1015" width="300" height="30" as="geometry" />
        </mxCell>

        <mxCell id="algo-update" value="algorithm.update()&#xa;For 4 epochs:&#xa;  For each minibatch:&#xa;    Compute losses" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="1050" width="180" height="80" as="geometry" />
        </mxCell>

        <mxCell id="evaluate-actions" value="evaluate_actions()&#xa;Re-evaluate batch:&#xa;- actor(obs) → logits&#xa;- critic(obs) → values&#xa;- Compute log_probs&#xa;- Compute entropy" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="300" y="1050" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="compute-loss" value="compute_ppo_loss()&#xa;- Policy loss (clipped)&#xa;- Value loss (MSE)&#xa;- Entropy loss&#xa;total = policy + 0.5*value + 0.01*entropy" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="540" y="1050" width="240" height="110" as="geometry" />
        </mxCell>

        <mxCell id="backprop" value="BACKPROPAGATION&#xa;1. total_loss.backward()&#xa;2. Clip gradients (0.5)&#xa;3. actor_optimizer.step()&#xa;4. critic_optimizer.step()&#xa;&#xa;Updates:&#xa;- Encoder (from both)&#xa;- Policy head&#xa;- Value function" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc0000;align=left;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="820" y="1040" width="200" height="130" as="geometry" />
        </mxCell>

        <!-- Gradient flow visualization -->
        <mxCell id="gradient-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#cc0000;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1060" y="1040" width="280" height="130" as="geometry" />
        </mxCell>
        <mxCell id="gradient-label" value="Gradient Flow" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="1140" y="1045" width="120" height="20" as="geometry" />
        </mxCell>

        <mxCell id="grad-encoder" value="Encoder&#xa;∇ from policy +&#xa;∇ from value" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6e6;strokeColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="1080" y="1075" width="80" height="80" as="geometry" />
        </mxCell>

        <mxCell id="grad-policy" value="Policy&#xa;∇ from&#xa;policy loss" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6e6;strokeColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="1175" y="1075" width="70" height="80" as="geometry" />
        </mxCell>

        <mxCell id="grad-value" value="Value&#xa;∇ from&#xa;value loss" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6e6;strokeColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="1255" y="1075" width="70" height="80" as="geometry" />
        </mxCell>

        <!-- Arrows in update -->
        <mxCell id="arrow-update-to-eval" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="algo-update" target="evaluate-actions">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-eval-to-loss" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="evaluate-actions" target="compute-loss">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-loss-to-backprop" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#cc0000;strokeWidth=3;" edge="1" parent="1" source="compute-loss" target="backprop">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-loss-label" value="compute gradients" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#cc0000;fontStyle=1" vertex="1" connectable="0" parent="arrow-loss-to-backprop">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-backprop-to-grad" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#cc0000;strokeWidth=2;" edge="1" parent="1" source="backprop" target="gradient-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="1260" y="80" width="280" height="250" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1350" y="85" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-entry" value="Entry/Config" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1280" y="120" width="100" height="25" as="geometry" />
        </mxCell>

        <mxCell id="legend-trainer" value="Trainer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="1280" y="150" width="100" height="25" as="geometry" />
        </mxCell>

        <mxCell id="legend-components" value="Components" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1280" y="180" width="100" height="25" as="geometry" />
        </mxCell>

        <mxCell id="legend-algorithm" value="Algorithm" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1280" y="210" width="100" height="25" as="geometry" />
        </mxCell>

        <mxCell id="legend-training" value="Training Loop" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="1280" y="240" width="100" height="25" as="geometry" />
        </mxCell>

        <mxCell id="legend-backprop" value="Backprop" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="1280" y="270" width="100" height="25" as="geometry" />
        </mxCell>

        <mxCell id="legend-desc" value="Modular Architecture:&#xa;- Components reusable&#xa;- Shared encoder&#xa;- Clean separation" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1400" y="120" width="130" height="80" as="geometry" />
        </mxCell>

        <!-- Key Insight Box -->
        <mxCell id="insight-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff4e6;strokeColor=#ff9900;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="980" y="350" width="280" height="150" as="geometry" />
        </mxCell>
        <mxCell id="insight-title" value="⚡ Key Innovation" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=13;fontStyle=1;fontColor=#ff9900;" vertex="1" parent="1">
          <mxGeometry x="1030" y="355" width="180" height="25" as="geometry" />
        </mxCell>
        <mxCell id="insight-text" value="Modular components are&#xa;created SEPARATELY, then&#xa;INJECTED into algorithm.&#xa;&#xa;Encoder is SHARED between&#xa;actor and critic - receives&#xa;gradients from both losses.&#xa;&#xa;This enables paradigm-specific&#xa;trainers while keeping&#xa;algorithms reusable." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="995" y="385" width="250" height="105" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
